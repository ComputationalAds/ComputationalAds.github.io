
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>计算广告与机器学习</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ZhouYong">
    

    
    <meta name="description" content="广告是流量变现的主要手段！鄙站主要梳理在线广告的主要产品形态，并就不同产品形态中的涉及的核心技术，尤其是大规模机器学习、投放推荐策略、基础数据挖掘以及博弈论（机制、均衡、拍卖）等方面，分享一些解决方案、经验教训和走过的坑儿！">
<meta property="og:type" content="article">
<meta property="og:title" content="计算广告与机器学习">
<meta property="og:url" content="http://www.52caml.com/page/3/index.html">
<meta property="og:site_name" content="计算广告与机器学习">
<meta property="og:description" content="广告是流量变现的主要手段！鄙站主要梳理在线广告的主要产品形态，并就不同产品形态中的涉及的核心技术，尤其是大规模机器学习、投放推荐策略、基础数据挖掘以及博弈论（机制、均衡、拍卖）等方面，分享一些解决方案、经验教训和走过的坑儿！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="计算广告与机器学习">
<meta name="twitter:description" content="广告是流量变现的主要手段！鄙站主要梳理在线广告的主要产品形态，并就不同产品形态中的涉及的核心技术，尤其是大规模机器学习、投放推荐策略、基础数据挖掘以及博弈论（机制、均衡、拍卖）等方面，分享一些解决方案、经验教训和走过的坑儿！">

    
    <link rel="alternative" href="/atom.xml" title="计算广告与机器学习" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="计算广告与机器学习" title="计算广告与机器学习"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="计算广告与机器学习">计算广告与机器学习</a></h1>
				<h2 class="blog-motto">Computational Advertising and Machine Learning</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/home">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:www.52caml.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/computational_ads/ca_roadmap/" title="计算广告学-RoadMap" itemprop="url">计算广告学-RoadMap</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ZhouYong" target="_blank" itemprop="author">ZhouYong</a>
		
  <p class="article-time">
    <time datetime="2015-05-09T14:31:24.000Z" itemprop="datePublished"> 发表于 2015-05-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>Author: zhouyongsdzh@foxmail.com </p>
<p>Date: 2015-05-09</p>
</blockquote>
<p>说明</p>
<p>这里阐述了在线广告介绍以及产品形态、用户画像、大规模约束优化、CTR预估、流量预估、竞价机制设计、广告拍卖等计算广告学核心概念和技术进行总结与梳理</p>
<h2 id="第一部分：广告与计算">第一部分：广告与计算</h2><ul>
<li>第01章：在线广告介绍</li>
<li>第02章：计算广告基础知识</li>
<li>第03章：受众定向</li>
</ul>
<h2 id="第二部分：合约广告系统">第二部分：合约广告系统</h2><ul>
<li>第04章：流量预估</li>
<li>第05章：在线分配</li>
</ul>
<h2 id="第三部分：竞价广告系统">第三部分：竞价广告系统</h2><ul>
<li>第06章：匹配与相关性计算</li>
<li>第07章：广告检索</li>
<li>第08章：点击率预估</li>
<li>第09章：竞价机制设计</li>
</ul>
<h2 id="第四部分：广告交易系统">第四部分：广告交易系统</h2><ul>
<li>第10章：交易与拍卖理论</li>
<li>第11章：在线广告生态系统</li>
<li>第12章：需求方平台</li>
<li>第13章：供给方平台</li>
<li>第14章：数据管理平台</li>
</ul>
<h2 id="第五部分：广告智能推荐">第五部分：广告智能推荐</h2><ul>
<li>第15章：推荐与广告</li>
<li>第16章：推荐系统与算法</li>
</ul>
<h2 id="第六部分：广告相关技术">第六部分：广告相关技术</h2><ul>
<li>第17章：智能频次控制</li>
<li>第18章：反作弊技术</li>
<li>第19章：效果监控与可视化</li>
<li>第20章：隐私保护与数据安全</li>
</ul>
<h2 id="第七部分：大数据与机器学习">第七部分：大数据与机器学习</h2><ul>
<li>第21章：大数据框架在广告系统中的应用</li>
<li>第22章：机器学习在广告系统中的应用</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/计算广告学/">计算广告学</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/计算广告学/">计算广告学</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/computational_ads/ca-chapter1.1-introduction/" title="Chapter1.1 网络广告的前世今生" itemprop="url">Chapter1.1 网络广告的前世今生</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ZhouYong" target="_blank" itemprop="author">ZhouYong</a>
		
  <p class="article-time">
    <time datetime="2015-04-20T14:54:37.000Z" itemprop="datePublished"> 发表于 2015-04-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <ul>
<li>Author: zhouyongsdzh@foxmail.com </li>
<li>Date: 2015-04-20</li>
</ul>
<h3 id="写在前面"><strong>写在前面</strong></h3><p>计算广告学从字面上理解主要包括两个方面，一个是广告，另一个是计算。如果在20年甚至10年之前，人们也许想不到计算与广告也会发生关系。然而在互联网时代快速变迁的今天，以大数据和人工智能为核心的互联网时代，不仅加剧对传统行业的改造，同时也改变了互联网自身的商业变现模式与规则。</p>
<p>我们先来看看广告是什么？有人说是市场营销的一种手段，是商业推广最给力的工具之一等等。 一言以蔽之，广告的背后是商业及其内在的规模。</p>
<p>广告里的计算又是什么呢？包括哪些内容呢？这里的计算不仅包括大规模的数据处理、数据分析、数据存储、数据挖掘、机器学习、海量数据计算（离线计算、流式计算、内存计算），同时也涉及到博弈、竞价、拍卖、交易等经济学范畴的综合体。</p>
<p>下面，我们分别介绍这两部分包含的内容。</p>
<h3 id="1-1_网络广告分类">1.1 网络广告分类</h3><p>按计费方式、广告创意、投放方式、广告产品形态等分类</p>
<h3 id="1-2_网络广告发展史">1.2 网络广告发展史</h3><p>1994年开始 -&gt; 展示、搜索 -&gt; 技术驱动 -&gt; 当前广告生态圈</p>
<p>世界广告的发展史可以追溯至几千年前。而网络广告的媒介是互联网，互联网的发展从1969年至今还未到半个世纪，因此网络广告的历史就更短了。</p>
<p>第一个网络广告何时、何地出现的呢？追本溯源，网络广告起源于美国。1994年10月27日是网络广告发展史上的里程碑，当时著名的商业网络杂志Hotwired推出了网络版的Hotwired（注：美国科技新闻评论网，现更名为Wired，2006年7月11日被Conde Nast Publishing收购），并首次在网站上推出了网络广告，在当时立即吸引了AT&amp;T等14个客户在其主页上发布广告，10月27日，AT&amp;T的一个468*60的Banner广告出现在页面上时，标志着网络广告正式诞生。更值得一提的是，该广告的点击率达到40%。</p>
<p>像AT&amp;T这种在网站的页面上展示banner广告创意的产品形式，这种投放方式称为<strong>展示广告（Display Advertising）</strong>。虽然是在网络这个新媒介上展示，但基本延续了传统广告投放的那一套思路和逻辑。大致过程如下：4A广告代理公司（如奥美等）把网站上的HTML页面当作杂志的版面，在里面设置广告位，然后把广告的创意（图片方式）嵌入到广告位中。网站在广告代理商眼里就相当于一本本的杂志，采买的思路和逻辑与线下的报刊、杂志基本无异。</p>
<p>还有一个非常重要的关键点，就是广告的售卖模式。想一下，广告主与传统的广告媒介（如电视、报刊、杂志等）是如何谈费用的？双方谈判的其中一个焦点就是广告投放位置、广告投放时间、每个时间单位（按天、周、月）的费用、广告投放的页面中是否可包括竞品的推广信息等，一切细节等谈妥后以合约的方式确定下来。像这种采用合同约定的方式确定某一广告位在某段时间内为某特定广告主所独占，确定广告创意允许范围以及同一页面上的广告排它策略等，这类售卖模式称为<strong>合约式广告（Agreement-based Advertising）</strong>。展示广告的发展在很长一段时间内都在采用传统广告的这一套售卖模式，至今为止这种售卖模式仍旧存在。</p>
<p>该阶段的广告虽然是按照时间单位计费，但是不同流量规模的网站在相同的时间单位内的费用自然也不同。一个每天拥有10亿流量的网站和另一个每天只有1亿流量的网站，如果广告主分别在这两个网站都投放1个月的广告，前者应该支付更高的费用。那个到底该如何去计费呢？业内普遍采用一个指标：千人成本。即1千个人看到展示的广告后，广告主应该向网站支付的广告成本，称为<strong>CPM计费（Cost Per Mille）</strong>。计算公式如下：</p>
<p>CPM =（广告费用/到达人数）×1000</p>
<p>在网络广告发展初期，当时比较大的在线媒体，如AOL（美国在线）、雅虎等网站，已经有了不错的流量规模，它们采用展示广告＋合约售卖的方式，给自身带来了相当可观的营收和利润。那么，随着流量的增长和品牌认知度的提高，通过提高广告位报价的方式，可以保证这些互联网公司业绩的持续增长。但是当网站的流量规模和品牌认知度趋于稳定时，广告主很难再接受广告位的提价，那这些互联网企业又该如何保证业绩的增长呢？</p>
<p>事情发展到此时，貌似出现了瓶颈。但是不久之后，互联网广告的运营者们经过探索，发现了在线广告不同于传统媒体广告的一个本质特点：<strong>同一个广告位可以对不同的受众（Audience）呈现不同的广告创意</strong>。</p>
<blockquote>
<p>举例：两个广告A和B，A广告的定位人群是男性，B广告的定位人群是女性。广告位P每天touch的流量有100W，其中男女比例1:1，各50万。</p>
<p>按照之前的方式，广告位P只能展示一种广告（非A即B），给广告主带来的收益为1W。但是不管P展示的A还是B，对于广告主而言只能得到50W的有效流量，另外50W对广告主没有意义。因为任何一个产品都有自己的受众人群，非受众人群对该产品很少带来转化。</p>
<p>现在同一个广告位可以针对不同的人群展示不同的广告创意，判断如果该流量对应的用户是男性，给其展示A广告；如果是女性，展示B广告。</p>
<p>此时对于A、B广告主而言，都获得了50W的有效流量。对于任意一个广告主而言，之前100W流量需要1W的费用，现在的流量虽然是50W，但有效流量的比重在提升，费用应该在(5K, 1W]之间，假设是6K。那么网站从广告主那里拿到的总费用为1.2W。</p>
<p>对于网站而言，流量没有变化，但是通过计算用户性别（属于受众定向范畴，第3章详细介绍）的方式可以让收益从1W增加到1.2W。</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/计算广告学/">计算广告学</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/计算广告学/">计算广告学</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/deep_learning/cpp_summary_note/" title="C++总结笔记" itemprop="url">C++总结笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ZhouYong" target="_blank" itemprop="author">ZhouYong</a>
		
  <p class="article-time">
    <time datetime="2014-12-20T07:42:23.000Z" itemprop="datePublished"> 发表于 2014-12-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <ul>
<li>author: zhouyongsdzh@foxmail.com</li>
<li>date: 2014-12-25</li>
<li>weibo: <a href="http://weibo.com/p/1005051707438033/home?" target="_blank" rel="external">@周永_52ML</a></li>
</ul>
<hr>
<p><strong>内容列表</strong></p>
<ul>
<li>写在前面</li>
<li>调试与程序分析工具<ul>
<li>gdb</li>
<li>gperf </li>
</ul>
</li>
<li>多线程编程</li>
<li>踩过的坑儿<ul>
<li><a href="#1.undefined-reference-to">1.undefined reference to …</a></li>
</ul>
</li>
</ul>
<h1 id="踩过的坑儿">踩过的坑儿</h1>

<h2 id="1.undefined-reference-to">1.undefined reference to …</h2>

<p>参考链接：<a href="http://blog.csdn.net/jfkidear/article/details/8276203" target="_blank" rel="external">http://blog.csdn.net/jfkidear/article/details/8276203</a></p>
<p>异常示例1：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">undefined reference to `dmlc::Config::Config(<span class="built_in">std</span>::istream&amp;, <span class="keyword">bool</span>)'</span><br></pre></td></tr></table></figure>
<p>主要原因是<figure class="highlight"><figcaption><span>**链接库函数代码，即```target_link_libraries($&#123;exec_name&#125; dmlc)```**，相当于在g++上添加了参数```-ldmlc```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#62; &#31867;&#20284;&#30340;&#38382;&#39064;&#65306; ```undefined reference to &#39;pthread_create&#39;``` &#38656;&#35201;&#28155;&#21152;```-lpthread</span><br></pre></td></tr></table></figure></p>
<p>异常示例2: </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/workplace/DiMLSys/third_party/root/lib/libdmlc.a(hdfs_filesys.o): In function `dmlc::io::HDFSFileSystem::HDFSFileSystem(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;)':</span><br><span class="line">hdfs_filesys.cc:(.text+0xb1): undefined reference to `hdfsConnect'</span><br><span class="line">~/workplace/DiMLSys/third_party/root/lib/libdmlc.a(hdfs_filesys.o): In function `dmlc::io::HDFSFileSystem::GetPathInfo(dmlc::io::URI const&amp;)':</span><br><span class="line">hdfs_filesys.cc:(.text+0xcd0): undefined reference to `hdfsGetPathInfo'</span><br><span class="line">hdfs_filesys.cc:(.text+0x143a): undefined reference to `hdfsFreeFileInfo</span><br></pre></td></tr></table></figure>
<p>编译dmlc-core时，发现是<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#24322;&#24120;&#31034;&#20363;3: &#10;&#10;```c++ &#10;undefined reference to `omp_get_num_procs`</span><br></pre></td></tr></table></figure></p>
<p>主要原因是使用了OpenMP，但编译时没有配置OpenMP相关编译环境，需要在CMakeLists.txt中配置<figure class="highlight"><figcaption><span>set(CMAKE_CXX_FLAGS "$&#123;CMAKE_CXX_FLAGS&#125; $&#123;OpenMP_CXX_FLAGS&#125;")```条件。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#20351;&#29992;OpenMP&#26102;&#65292;&#38656;&#35201;&#22312;CMake&#25991;&#20214;&#20013; &#28155;&#21152; **&#32534;&#35793;&#29615;&#22659;&#20195;&#30721;**&#65292;&#21363;&#65306;```set(CMAKE_CXX_FLAGS &#34;$&#123;CMAKE_CXX_FLAGS&#125; $&#123;OpenMP_CXX_FLAGS&#125;&#34;)```.&#10;&#10;&#24322;&#24120;&#31034;&#20363;4&#65306;&#10;&#10;```c++&#10;undefined reference to mit::FFM&#60;unsigned long, float&#62;::Predict(dmlc::Row&#60;unsigned long&#62; const&#38;, std::vector&#60;unsigned long, std::allocator&#60;unsigned long&#62; &#62; const&#38;, std::vector&#60;float, std::allocator&#60;float&#62; &#62; const&#38;, std::vector&#60;int, std::allocator&#60;int&#62; &#62; const&#38;)&#39;</span><br></pre></td></tr></table></figure></p>
<p>主要原因：是这里把<strong>模版类分离编译</strong>导致。就是把模版类的声明和实现分别放在了头文件和源文件中。而<strong>g++本身不支持模版类的分离编译</strong>，所有提示找不到方法的具体实现（在*.cc中）。</p>
<p>解决方案：要么不使用模版类，要么把声明和定义放在同一个*.h文件中。参考：<a href="http://blog.sina.com.cn/s/blog_6cef0cb50100nb7o.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_6cef0cb50100nb7o.html</a></p>
<p>异常示例5: </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thrift-<span class="number">0.10</span>.0/lib/cpp/src/thrift/server/TNonblockingServer.cpp:<span class="number">1602</span>: undefined reference to `event_del'</span><br></pre></td></tr></table></figure>
<p>使用<code>nm libevent.a | grep event_del</code>查看，静态包里面存在该函数。头文件和库文件都存在。因此这种情况大概率是库文件顺序错误。把libevent.a放在libthrift.a之后，编译正常。参考<a href="https://github.com/ComputationalAdvertising/tech-stacks/blob/master/rpc_thrift/CMakeLists.txt" target="_blank" rel="external"><code>rpc_thrift/CMakeLists.txt</code></a></p>
<p>同示例5:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/src/thrift/transport/TBufferTransports.h:544: undefined reference to 'vtable for apache::thrift::transport::TMemoryBuffer'</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">这里的问题是依赖库`libthrift.a与libthriftnb.a`的先后顺序导致。**应该`libthriftnb.a`在前，`libthrift.a`在后**。</span><br><span class="line"></span><br><span class="line">&gt; 注意：thrift安装问题，如果./configure时出现以下错误，可编辑configure文件，注释掉所有的`PKG_CHECK_MODULES`检查。</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>./configure: line 18262: syntax error near unexpected token <code>QT,&#39;
./configure: line 18262:</code>    PKG_CHECK_MODULES(QT, QtCore &gt;= 4.3, QtNetwork &gt;= 4.3, have_qt=yes, have_qt=no)’<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="label">异常示例6:</span> Linux环境openmit-ps生成可执行文件时，如果链接静态库时，编译失败；链接动态库时，编译成功。可以确定静态库中包含undefined的函数和变量。</span><br><span class="line"></span><br><span class="line">解决方案：静态库生成的编译环境中添加<span class="escape">`-</span>shared -fPIC<span class="escape">`。</span>如此，再生成动态库时，如果依赖了添加<span class="escape">`-</span>shared -fPIC<span class="escape">`的</span>静态库时，应该能成功。⚠️ **共享库编译选项不能出现在编译目标为可执行文件的编译任务上，这里的<span class="escape">`-</span>shared<span class="escape">`不</span>能出现在上面**。 </span><br><span class="line"></span><br><span class="line"><span class="label">异常示例7:</span> </span><br><span class="line"></span><br><span class="line"><span class="escape">``</span><span class="escape">`b</span>ash</span><br><span class="line"><span class="label">Undefined symbols for architecture x86_64:</span></span><br><span class="line">  <span class="string">"openmi::LocalDevice::use_global_threadpool_"</span>, referenced from:</span><br><span class="line"><span class="label">      openmi::LocalDevice::LocalDevice(openmi::</span>Allocator*, int) in libopenmi_core.<span class="literal">a</span>(local_device.o)</span><br></pre></td></tr></table></figure></p>
<p>原因：LocalDevice中的全局静态变量未初始化。在对应*.cc文件中初始化即可。 </p>
<p>因此，出现<figure class="highlight"><figcaption><span>reference to `...` ```问题时，通常有如下原因：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;1. &#26816;&#26597;include&#22836;&#25991;&#20214;&#26159;&#21542;&#23384;&#22312;&#65292;&#22914;&#26524;&#27809;&#26377;&#38656;&#35201;&#28155;&#21152;```include_directories()</span><br></pre></td></tr></table></figure></p>
<ol>
<li>检查相应的链接库是否存在，如果没有需要<figure class="highlight"><figcaption><span>dmlc)```;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3. &#26816;&#26597;&#23545;&#24212;&#30340;&#32534;&#35793;&#29615;&#22659;&#26159;&#21542;&#32570;&#22833;&#65292;&#27604;&#22914;pthread, OpenMP&#37117;&#38656;&#35201;&#22312;g++&#32534;&#35793;&#26102;&#65292;&#28155;&#21152;&#23545;&#24212;&#30340;&#32534;&#35793;&#29615;&#22659;&#12290;&#10;4. &#26597;&#30475;&#23545;&#24212;&#30340;&#31867;&#26159;&#21542;&#26159;&#27169;&#29256;&#31867;&#12290;&#22914;&#26524;&#26159;&#27169;&#29256;&#31867;&#65292;&#19981;&#24212;&#35813;&#26377;&#23545;&#24212;&#30340;*.cc&#25991;&#20214;&#65292;&#22240;&#20026;g++&#19981;&#25903;&#25345;&#27169;&#29256;&#31867;&#30340;&#20998;&#31163;&#32534;&#35793;&#65307;&#10;5. &#22914;&#26524;&#22836;&#25991;&#20214;&#21644;&#24211;&#25991;&#20214;&#22343;&#23384;&#22312;&#65292;&#21487;&#23581;&#35797;**&#35843;&#25972;&#24211;&#25991;&#20214;&#39034;&#24207;**&#12290;&#10;6. &#20381;&#36182;&#38745;&#24577;&#24211;&#32534;&#35793;&#22833;&#36133;&#65292;&#20381;&#36182;&#21160;&#24577;&#24211;&#32534;&#35793;&#25104;&#21151;&#12290;&#35299;&#20915;&#26041;&#26696;&#65306;**&#38745;&#24577;&#24211;&#37325;&#26032;&#32534;&#35793;&#65292;&#24182;&#28155;&#21152;`-shared -fPIC`**&#12290;&#27880;&#24847;&#65306;&#21487;&#25191;&#34892;&#31243;&#24207;&#19981;&#21487;&#28155;&#21152;&#38745;&#24577;&#24211;&#32534;&#35793;&#36873;&#39033;&#12290;&#10;&#10;&#10;&#60;h2 id=&#34;2.error-while-loading-shared-libraries&#34;&#62;2. error while loading shared libraries: *.so : cannot open shared object file&#60;/h2&#62;&#10;&#10;[... error while loading shared libraries: *.so : cannot open shared object file: No such file or directory](http://blog.csdn.net/sahusoft/article/details/7388617)&#10;&#10;&#38169;&#35823;&#25552;&#31034;&#31243;&#24207;&#25191;&#34892;&#26102;&#26080;&#27861;&#21152;&#36733;&#20849;&#20139;&#24211;```*.so```&#65292;&#21487;&#33021;&#19981;&#23384;&#22312;&#25110;&#32773;&#27809;&#26377;&#25214;&#21040;&#12290;&#10;&#10;&#35299;&#20915;&#26041;&#26696;&#65306;&#10;&#10;1. &#39318;&#20808;&#65292;&#29992;```locate *.so```&#21629;&#20196;&#26816;&#26597;&#20849;&#20139;&#24211;&#26159;&#21542;&#23384;&#22312;&#65292;&#22914;&#26524;&#19981;&#23384;&#22312;&#65292;&#38656;&#35201;&#32593;&#19978;&#19979;&#36733;&#21644;&#23433;&#35013;&#12290;&#22914;&#26524;&#23384;&#22312;&#65292;&#36827;&#20837;&#31532;&#20108;&#27493;&#10;2. &#23558;```*.so```&#25152;&#23545;&#24212;&#30340;&#30446;&#24405;&#21152;&#20837;```LD_LIBRARY_PATH```&#36335;&#24452;&#20013;&#65292;&#20030;&#20363;&#25805;&#20316;&#65306;&#10;&#10;```sh&#10;LD_LIBRARY_PATH=$&#123;JAVA_HOME&#125;/jre/lib/amd64/servier:$LD_LIBRARY_PATH&#10;export LD_LIBRARY_PATH&#10;``` &#10;&#10;&#19978;&#38754;&#30340;&#37197;&#32622;&#22312;MakeFile&#20013;&#21487;&#20197;&#30452;&#25509;&#25214;&#21040;&#23545;&#24212;&#30340;&#29615;&#22659;&#21464;&#37327;&#12290;&#22312;CMakeLists&#20013;&#22914;&#20309;&#20351;&#29992;&#21602;&#65311; cmake&#20351;&#29992;&#29615;&#22659;&#21464;&#37327;&#65292;&#38656;&#35201;&#20351;&#29992;```ENV```&#20851;&#38190;&#35789;&#12290;&#21363;: ```$ENV&#123;LD_LIBRARY_PATH&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>在使用automake编译时，也出现类似的错误：<code>./openmit: error while loading shared libraries: libprotobuf.so.12: cannot open shared object file: No such file or directory</code>. automake下的解决方案是？</p>
<h2 id="3.invalid-initialization-of-non-const- reference-of-type">3. invalid initialization of non-const reference of type</h2>

<p><a href="http://blog.csdn.net/kongying168/article/details/3864756" target="_blank" rel="external">…invalid initialization of non-const reference of type…</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/workspace/openmit/openmit/include/openmit/data.h:<span class="number">24</span>:<span class="number">41</span>: error: invalid initialization of non-const reference of <span class="built_in">type</span> ‘std::__cxx11::string&amp; &#123;aka std::__cxx11::basic_string&lt;char&gt;&amp;&#125;’ from an rvalue of <span class="built_in">type</span> ‘std::__cxx11::string &#123;aka std::__cxx11::basic_string&lt;char&gt;&#125;’</span><br><span class="line">             std::string &amp; data_format = <span class="string">"auto"</span>) &#123;</span><br></pre></td></tr></table></figure>
<p>错误提示的含义：c++中临时变量不能作为非const的引用参数</p>
<p>—</p>
<h2 id="4.multiple-definition-of">4. …multiple definition of …</h2>


<p><a href="http://blog.csdn.net/xxxxxx91116/article/details/7446455" target="_blank" rel="external">…multiple definition of …</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMakeFiles/openmit.dir/worker.cc.o: In function `mit::WorkerParam::__MANAGER__()':</span><br><span class="line">worker.cc:(.text+0x176): multiple definition of `mit::WorkerParam::__MANAGER__()'   // worker.cc提示多次定义error</span><br><span class="line">CMakeFiles/openmit.dir/cli_main.cc.o:cli_main.cc:(.text+0x3b6): first defined here    // 最早在cli_main.cc中被定义</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br></pre></td></tr></table></figure>
<p>上面出现错误的原因：把变量的定义（<code>DMLC_REGISTER_PARAMETER(WorkerParam);</code>）放在了worker.h文件中，而worker.cc和cli_main.cc都include了worker.h，进行了两次变量的定义，所以提示错误。</p>
<p>解决方案：worker.h中的变量定义放在worker.cc中。如此可避免变量重复定义的问题。</p>
<blockquote>
<ol>
<li>编译是针对一个一个文件来说的，而链接则是针对一个工程所有的.o文件而言的；</li>
<li>ifndef只是对防止一个文件的重复编译有效；</li>
<li>全局变量最好在.cpp文件中定义，在.h文件中加上extern申明，因为在.h文件中定义，容易在链接时造成变量重定义；</li>
</ol>
<p>如果有“公共函数”需要放在base.h文件中，比如<code>void NewKey(...) { ... }</code>，为了防止出现<code>multiple defination of ...</code>问题，可以在前面加上<code>inline</code>，即<code>inline void NewKey(...) { ... }</code></p>
</blockquote>
<h2 id="5.error-cannot-allocate-an-object-of-abstract-type">5. …error: cannot allocate an object of abstract type …</h2>

<p><a href="http://blog.csdn.net/u012474678/article/details/38866415" target="_blank" rel="external"> …error: cannot allocate an object of abstract type …</a></p>
<p>在基类中申明的虚函数，在派生类中必须继承并实现。在new一个派生类时才不会报该错误。</p>
<p>此外，<code>Unit * base = new SimpleUnit();</code>而不能是<code>Unit base = new SimpleUnit();</code>. </p>
<p>在C++中，new一个类时，需要用指针接着。参考：<a href="http://blog.csdn.net/autoliuweijie/article/details/50579275" target="_blank" rel="external">C++创建对象，new与不new的区别</a></p>
<h2 id="6.Error-in:free():invalid-pointer">6. … Error in `./xx’: free(): invalid pointer: 0x00000000006042e0 …</h2>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">*** Error in `./xx': free(): invalid pointer: 0x00000000006042e0 ***</span><br><span class="line">======= Backtrace: =========</span><br><span class="line">/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f3989dea7e5]</span><br><span class="line">/lib/x86_64-linux-gnu/libc.so.6(+0x7fe0a)[0x7f3989df2e0a]</span><br><span class="line">/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f3989df698c]</span><br><span class="line">./xx[0x4015dc]</span><br><span class="line">./xx[0x401d02]</span><br><span class="line">./xx[0x401bdb]</span><br><span class="line">./xx[0x401397]</span><br><span class="line">/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7f3989d93830]</span><br><span class="line">./xx[0x401039]</span><br><span class="line">======= Memory map: ========</span><br><span class="line">00400000-00403000 r-xp 00000000 08:01 2490760                            ~/workspace/openmit/openmit/language/xx</span><br><span class="line">...</span><br><span class="line">7f398a351000-7f398a352000 rw-p 00015000 08:01 398344                     /lib/x86_64-linux-gnu/libgcc_s.so.1</span><br><span class="line">...</span><br><span class="line">7f398a6d0000-7f398a6d4000 rw-p 00000000 00:00 0 </span><br><span class="line">7f398a6d4000-7f398a6fa000 r-xp 00000000 08:01 397534                     /lib/x86_64-linux-gnu/ld-2.23.so</span><br><span class="line">...</span><br><span class="line">7f398a8fb000-7f398a8fc000 rw-p 00000000 00:00 0 </span><br><span class="line">7fffc3ff7000-7fffc4019000 rw-p 00000000 00:00 0                          [stack]</span><br><span class="line">7fffc41e1000-7fffc41e3000 r--p 00000000 00:00 0                          [vvar]</span><br><span class="line">7fffc41e3000-7fffc41e5000 r-xp 00000000 00:00 0                          [vdso]</span><br><span class="line">ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]</span><br><span class="line">Aborted (core dumped)</span><br></pre></td></tr></table></figure>
<p>背景：在工厂方法派生类返回实现, 对应的调用方式：<code>std::unique_ptr&lt;A&gt; a(A::Create(&quot;b&quot;, 10));</code> 报的错误：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> B * Get(<span class="built_in">std</span>::<span class="built_in">string</span> type, <span class="keyword">int</span> a) &#123;</span><br><span class="line">  <span class="comment">//return new B(type, a);</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> B <span class="title">b</span><span class="params">(type, a)</span></span>;      <span class="comment">// stack space</span></span><br><span class="line">  <span class="keyword">return</span> &amp; b;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">如果改成下面的实现方式则成功：</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line"><span class="keyword">static</span> B * Get(<span class="built_in">std</span>::<span class="built_in">string</span> type, <span class="keyword">int</span> a) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> B(type, a);    <span class="comment">// heap space</span></span><br><span class="line">  <span class="comment">//static B b(type, a);      </span></span><br><span class="line">  <span class="comment">//return &amp; b;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7.argument-discards-qualifiers-[-fpermissive]">7. as ‘this’ argument discards qualifiers [-fpermissive] …</h2>

<p>… error: passing ‘const std::unordered_map<int, mit::unit*="">’ as ‘this’ argument discards qualifiers [-fpermissive] …</int,></p>
<p>具体错误：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~/workspace/openmit/openmit/test/unittests/unittest_openmit_unit.cc: In function ‘<span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, mit::Unit*&gt;&amp;, <span class="keyword">int</span>)</span>’:</span><br><span class="line">~/workspace/openmit/openmit/test/unittests/unittest_openmit_unit.cc:7:37: error: passing ‘<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, mit::Unit*&gt;’ as ‘<span class="keyword">this</span>’ argument discards qualifiers [-fpermissive]</span><br><span class="line">   mit::Unit * unit </span>= map_weight_[key];</span><br><span class="line">                                     ^</span><br><span class="line">In file included from /usr/include/c++/<span class="number">5</span>/<span class="built_in">unordered_map</span>:<span class="number">48</span>:<span class="number">0</span>,</span><br><span class="line">                 from ~/workspace/openmit/openmit/include/openmit/unit.h:<span class="number">4</span>,</span><br><span class="line">                 from ~/workspace/openmit/openmit/test/unittests/unittest_openmit_unit.cc:<span class="number">1</span>:</span><br><span class="line">/usr/include/c++/<span class="number">5</span>/bits/<span class="built_in">unordered_map</span>.h:<span class="number">667</span>:<span class="number">7</span>: note:   in call to ‘<span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;_Key, _Tp, _Hash, _Pred, _Alloc&gt;::mapped_type&amp; <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;_Key, _Tp, _Hash, _Pred, _Alloc&gt;::<span class="keyword">operator</span>[](<span class="keyword">const</span> key_type&amp;) [with _Key = <span class="keyword">int</span>; _Tp = mit::Unit*; _Hash = <span class="built_in">std</span>::hash&lt;<span class="keyword">int</span>&gt;; _Pred = <span class="built_in">std</span>::equal_to&lt;<span class="keyword">int</span>&gt;; _Alloc = <span class="built_in">std</span>::allocator&lt;<span class="built_in">std</span>::pair&lt;<span class="keyword">const</span> <span class="keyword">int</span>, mit::Unit*&gt; &gt;; <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;_Key, _Tp, _Hash, _Pred, _Alloc&gt;::mapped_type = mit::Unit*; <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;_Key, _Tp, _Hash, _Pred, _Alloc&gt;::key_type = <span class="keyword">int</span>]’</span><br><span class="line">       <span class="keyword">operator</span>[](<span class="keyword">const</span> key_type&amp; __k)</span><br></pre></td></tr></table></figure>
<p>问题背景：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, mit::Unit * &gt; &amp; map_weight_, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">  mit::Unit * unit = map_weight_[key];</span><br><span class="line">  unit-&gt;SetLinearItem(<span class="number">0.0999</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"unit.Linear: "</span> &lt;&lt; unit-&gt;LinearWeight() &lt;&lt; <span class="built_in">std</span>::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要原因是：当<code>const map_weight_</code>对象调用<code>operator[]</code>时，编译器检测出问题。<strong>对一个const对象调用non-const成员函数是不允许的，因为non-const成员函数不保证一定不修改对象。</strong></p>
<p>编译器在这里做了一个假定，假定<code>operator[]</code>试图修改<code>map_weight_</code>对象，而与此同时，<code>map_weight_</code>是const的，<strong>所有试图修改const对象的都会报error</strong>。</p>
<p><strong><code>unordered_map</code>的<code>[]</code>运算符会在索引项不存在的时候自动创建一个对象，有可能会改变map本身，所以不能在一个const map对象上使用<code>[]</code>操作。
</strong></p>
<p>解决办法：<strong>去掉const</strong>，或者<code>operator[]</code>改成const方法（这里比较困难）.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, mit::Unit * &gt; &amp; map_weight_, <span class="keyword">int</span> key)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h2 id="8.double-free-free-invalid-pointer">8. double free / free: invalid pointer</h2>

<p><code>src/learner.cc</code>出现内存泄漏：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mit_float * pvals = map_grad[keys[<span class="number">0</span>]]-&gt;Data();</span><br><span class="line"><span class="keyword">auto</span> offset = map_grad[keys[<span class="number">0</span>]]-&gt;Size();</span><br><span class="line"><span class="keyword">for</span> (size_t i = <span class="number">1</span>; i &lt; nfeature; ++i) &#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Learner::Run i: "</span> &lt;&lt; i &lt;&lt; <span class="built_in">std</span>::endl;</span><br><span class="line">  <span class="built_in">memcpy</span>(pvals + offset, </span><br><span class="line">        map_grad[keys[i]]-&gt;Data(), </span><br><span class="line">        map_grad[keys[i]]-&gt;Size() * <span class="keyword">sizeof</span>(mit_float));</span><br><span class="line"></span><br><span class="line">  offset += map_grad[keys[i]]-&gt;Size();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"nfeature done"</span> &lt;&lt; <span class="built_in">std</span>::endl;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;mit_float&gt; grad_vals(pvals, pvals + offset);</span><br><span class="line">vals = &amp;grad_vals;</span><br></pre></td></tr></table></figure>
<p>换成下面代码则正常:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// map_grad_ --&gt; vals</span></span><br><span class="line">vals-&gt;clear();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0u</span>; i &lt; nfeature; i++) &#123;</span><br><span class="line">  mit::Unit * unit = map_grad[keys[i]];</span><br><span class="line">  vals-&gt;insert(vals-&gt;end(), </span><br><span class="line">      unit-&gt;Data(), unit-&gt;Data() + unit-&gt;Size());</span><br><span class="line">  <span class="keyword">delete</span> unit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续跟进问题：</p>
<blockquote>
<p>注意：</p>
<ol>
<li>一个地址只能由一个指针指向，不能多个指针指向一个地址，否则会出现<code>double free or corruption (fasttop) ...</code>问题;</li>
</ol>
</blockquote>
<h2 id="9.the-following-virtual-functions-are-pure-within">9. the following virtual functions are pure within ‘mit::FFM’…</h2>

<p>具体是<code>mit::Model</code>类中有4个纯虚函数(<code>virtual type method() = 0;</code>)，而在子类中仅覆写了两个(<code>override</code>)，因而提示`下面的虚函数是纯的，必需要覆写<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#62; &#32431;&#34394;&#20989;&#25968;&#65306;&#34;virtual type method() &#65309;0&#65307;&#34;&#65307; &#22914;&#26524;&#19981;&#24102;`=0`,&#21482;&#26377;`virtual type method();`&#21017;&#22312;&#23376;&#31867;&#20013;&#21487;&#20197;&#19981;&#35206;&#20889;&#65288;&#19981;&#36807;&#23384;&#22312;&#38544;&#24739;&#65289;&#12290;&#10;&#10;&#60;h2 id=&#34;10.binding-const-value_type-to-reference-of-type-discards-qualifiers&#34;&#62;10. binding &#8216;const `value_type` &#123;aka const float&#125;&#8217; to reference of type &#8216;`mit::mit_float`&#38; &#123;aka float&#38;&#125;&#8217; discards qualifiers&#60;/h2&#62; &#10;&#10;&#29616;&#35937;&#65306;&#21442;&#25968;&#20026;`const std::vector&#60;int&#62; &#38; keys`, &#29992;`keys[i]`&#21442;&#25968;&#35843;&#29992;&#21478;&#22806;&#19968;&#20010;&#20989;&#25968;`func(int &#38; key)`&#25253;&#30340;&#38169;&#35823;&#12290;&#10;&#10;&#35299;&#20915;&#21150;&#27861;&#65306;&#20989;&#25968;&#34892;&#21442;&#21152;&#19978;const&#21363;&#21487;&#65292;&#21363;`func(const int &#38; key)`&#10;&#10;&#60;h2 id=&#34;11.Program-terminated-with-signal-11-Segmentation-fault.0&#34;&#62;11. Program terminated with signal 11, Segmentation fault.0&#60;/h2&#62;&#10;&#10;[Program terminated with signal 11, Segmentation fault.0  0x00007f7113d037f1 in ?? ()](https://blog.csdn.net/xufandecsdn/article/details/80609546) &#10;&#10;&#32972;&#26223;&#65306;linux&#29615;&#22659;&#19979;&#32534;&#35793;openmit-ps&#65292;&#29983;&#25104;bin/&#123;client,server&#125;&#21487;&#25191;&#34892;&#25991;&#20214;&#12290;&#36816;&#34892;bin/server&#26159;&#25253;&#38169;&#12290;&#26597;&#30475;core&#25991;&#20214; &#21457;&#29616;&#19978;&#36848;&#38169;&#35823;&#12290;&#21363;**&#31243;&#24207;&#26410;&#36827;&#20837;main&#20989;&#25968;&#23601;&#20986;&#29616;&#27573;&#38169;&#35823;**&#12290;&#10;&#10;```sh&#10;Program terminated with signal 11, Segmentation fault.&#10;#0  0x00007f7113d037f1 in ?? ()&#10;(gdb) bt&#10;#0  0x00007f7113d037f1 in ?? ()&#10;#1  0x0000000000000000 in ?? ()&#10;(gdb)&#10;```&#10;&#10;&#38382;&#39064;&#23450;&#20301;&#65306;gdb&#21333;&#27493;&#35843;&#35797;&#21457;&#29616;&#38382;&#39064;&#12290;&#26816;&#26597;&#32534;&#35793;&#36873;&#39033;&#65292;&#21457;&#29616;&#26159;`CMAKE_CXX_FLAGS`&#32534;&#35793;&#36873;&#39033;&#21253;&#21547;`-shared -fPIC`&#12290;&#21407;&#26469;&#26159;**&#32534;&#35793;&#21442;&#25968;&#25630;&#38169;&#65292;&#23558;&#29983;&#25104;&#20849;&#20139;&#24211;&#30340;&#32534;&#35793;&#21442;&#25968;&#38169;&#35823;&#22320;&#29992;&#20110;&#29983;&#25104;&#21487;&#25191;&#34892;&#25991;&#20214;&#65281;**&#10;&#10;&#35299;&#20915;&#26041;&#26696;&#65306;**&#29983;&#25104;&#21487;&#25191;&#34892;&#31243;&#24207;&#30340;&#32534;&#35793;&#36873;&#39033;&#21435;&#38500;&#19982;&#20849;&#20139;&#24211;&#30456;&#20851;&#30340;&#32534;&#35793;&#21442;&#25968;**&#12290;&#10;&#10;&#38382;&#39064;&#65306;[&#21487;&#25191;&#34892;&#25991;&#20214;&#28155;&#21152;-static&#65292; &#25552;&#31034;/bin/ld: cannot find -lopenmit_idl &#65288;&#35813;&#30446;&#24405;&#19979;&#21482;&#26377;&#21160;&#24577;&#24211;&#65292;&#26080;&#38745;&#24577;&#24211;&#65289;&#12290; &#21435;&#38500;-static&#32534;&#35793;&#21487;&#20197;&#36890;&#36807;](https://www.cnblogs.com/yunsicai/p/3191002.html)&#12290;&#10;&#10;&#21407;&#22240;&#26159;&#65306;&#38142;&#25509;&#22120;&#65288;ld&#65289;&#40664;&#35748;&#20250;&#36830;&#25509;&#21160;&#24577;&#24211;&#65292;&#20294;&#22914;&#26524;&#32534;&#35793;&#36873;&#39033;&#28155;&#21152;-static&#22312;&#32534;&#35793;&#21487;&#25191;&#34892;&#31243;&#24207;&#26102;&#65292;&#20250;&#38142;&#25509;&#38745;&#24577;&#24211;&#65292;**&#22914;&#26524;&#38745;&#24577;&#24211;not exist&#65292;&#37027;&#20040;&#20250;&#25552;&#31034;cannot found**&#12290;&#10;&#10;&#31867;&#20284;&#30340;&#38169;&#35823;&#36824;&#26377;&#65306;&#10;&#10;```sh&#10;Reading symbols from featurex/featurex/test/test...done.&#10;[New Thread 6541]&#10;Core was generated by `./test&#39;.&#10;Program terminated with signal 11, Segmentation fault.&#10;#0  0x00000000000005d6 in ?? ()&#10;(gdb) bt&#10;#0  0x00000000000005d6 in ?? ()&#10;#1  0x00007f4f639d5600 in main (argc=Unhandled dwarf expression opcode 0xf3&#10;) at /opt/meituan/zhouyong03/featurex/featurex/test/test.cc:4&#10;(gdb)&#10;```&#10;&#10;&#60;h2 id=&#34;12.Heap-check-constructor-called-twice.&#34;&#62;12. Check failed: !`internal_init_start_has_run`: Heap-check constructor called twice.  Perhaps you both linked in the heap checker, and also used LD_PRELOAD to load it? Aborted (core dumped)]()&#60;/h2&#62;&#10;&#10;&#32972;&#26223;&#65306;openmit-ps&#32534;&#35793;&#29983;&#25104;&#21160;&#24577;&#24211;&#21644;&#21487;&#25191;&#34892;&#25991;&#20214; &#22343;&#38142;&#25509;&#20102;tcmalloc&#30340;&#38745;&#24577;&#24211;&#65288;libtcmalloc.a&#65289;&#65292;&#25191;&#34892;&#21487;&#25191;&#34892;&#25991;&#20214;`/bin/server`&#19978;&#36848;&#38169;&#35823;&#12290;&#22914;&#26524;&#38142;&#25509;&#21160;&#24577;&#24211;&#65288;libtcmalloc.so&#65289;&#65292;&#21017;&#21487;&#20197;&#27491;&#24120;&#36816;&#34892;&#12290;&#10;&#10;---&#10;### 13. **[-bash: ./bin/server: /lib/ld64.so.1: bad ELF interpreter: No such file or directory](https://stackoverflow.com/questions/23604471/ld64-so-present-in-ldd-missing-at-runtime)**&#10;&#10;&#32972;&#26223;&#65306;&#20351;&#29992;&#22914;&#19979;&#21629;&#20196;&#32534;&#35793;openmit-ps/test/server.cc&#26102;&#65292;&#36816;&#34892;`./bin/server`&#25253;&#19978;&#36848;&#38169;&#35823;&#12290;&#10;&#10;```sh&#10;/bin/g++ -std=c++11 -g -O3 -Wall -static -DNDEBUG -DHAVE_NETINET_IN_H -fopenmp -O2 -DNDEBUG -rdynamic CMakeFiles/server.dir/server.o -o ../../bin/server -L/home/sankuai/.openmit_deps/lib -L/opt/meituan/zhouyong03/openmix/openmit-ps/../openmit-common/lib -L/opt/meituan/zhouyong03/openmix/openmit-ps/../openmit-idl/lib -L/opt/meituan/zhouyong03/openmix/openmit-ps/lib -L/opt/meituan/zhouyong03/openmix/openmit-ps -L/home/sankuai/.openmit_deps/lib64 -static -Wl,--whole-archive -lopenmit_ps -Wl,--no-whole-archive -Wl,--eh-frame-hdr -Wl,-Bstatic -lopenmit_idl -lopenmit_common -lboost_system -lboost_thread -lthriftnb -lthrift -lprotobuf -lprotoc -lprotobuf-lite -lsnappy -levent -lssl -lglog -lgflags -ltcmalloc_minimal -Wl,-Bdynamic -lpthread -lrt&#10;```&#10;&#10;&#35299;&#20915;&#26041;&#26696;&#65306;&#20351;&#29992;`ldd &#21487;&#25191;&#34892;&#31243;&#24207;`&#21629;&#20196;&#65292;&#30475;&#20855;&#20307;&#30340;&#38169;&#35823;&#20449;&#24687;&#12290; &#10;&#10;```&#10;openmit-ps[master*]$ ldd bin/server&#10;     linux-vdso.so.1 =&#62;  (0x00007fff1f5fe000)&#10;     libpthread.so.0 =&#62; /lib64/libpthread.so.0 (0x00007f451a3ef000)&#10;     librt.so.1 =&#62; /lib64/librt.so.1 (0x00007f451a1e6000)&#10;     libstdc++.so.6 =&#62; /lib64/libstdc++.so.6 (0x00007f4519edd000)&#10;     libm.so.6 =&#62; /lib64/libm.so.6 (0x00007f4519bdb000)&#10;     libgomp.so.1 =&#62; /lib64/libgomp.so.1 (0x00007f45199b4000)&#10;     libc.so.6 =&#62; /lib64/libc.so.6 (0x00007f45195f3000)&#10;     /lib/ld64.so.1 =&#62; /lib64/ld-linux-x86-64.so.2 (0x00007f451a624000)&#10;     libgcc_s.so.1 =&#62; /lib64/libgcc_s.so.1 (0x00007f45193dd000)&#10;```&#10;&#10;&#26159;&#38142;&#25509;&#26102;&#30340;&#36335;&#24452;&#19982;&#36816;&#34892;&#26102;&#30340;&#19981;&#19968;&#33268;&#12290;&#10;&#10;&#35299;&#20915;&#21150;&#27861;&#65306;&#22312;`LINK_FALGS`&#36873;&#39033;&#20013;&#26174;&#31034;&#21046;&#23450;&#38142;&#25509;&#22120;&#65292;&#21363;&#28155;&#21152;`-Wl,--dynamic-linker=/lib64/ld-linux-x86-64.so.2`. &#21487;&#25191;&#34892;&#31243;&#24207;&#21487;&#20197;&#36816;&#34892;&#12290; &#10;&#10;CMake&#25351;&#23450;&#38142;&#25509;&#36873;&#39033;&#26041;&#24335;&#65306;[`SET_TARGET_PROPERTIES(foo PROPERTIES LINK_FLAGS -Wl,-whole-archive -lopenmit_ps ...)`](https://cmake.org/pipermail/cmake/2003-August/004244.html)&#10;&#10;---&#10;### 14. [`Exception in thread &#34;main&#34; java.lang.UnsatisfiedLinkError: libfeature_extractor.so: libfeature_extractor.so: cannot allocate memory in static TLS block`]()&#10;&#10;jni&#23478;&#22312;so&#26102;&#25253;&#38169;&#65292;&#19981;&#33021;&#20998;&#37197;&#38745;&#24577;TLS&#22359;&#65288;&#32447;&#31243;&#23616;&#37096;&#23384;&#20648;&#65289;&#12290;&#35201;&#27714;so&#20013;&#19981;&#21487;&#20197;&#23384;&#22312;&#38745;&#24577;&#21464;&#37327;&#12289;&#20840;&#23616;&#21464;&#37327;&#31561;&#12290;&#36825;&#37324;&#30340;&#35299;&#20915;&#26041;&#26696;&#65306;&#32534;&#35793;so&#26102;&#21435;&#38500;`-ltcmalloc_minimal`&#65292;&#37325;&#26032;&#32534;&#35793;so&#65292;&#20877;System.load()&#12290;&#21363;&#32534;&#35793;&#36873;&#39033;&#65306;&#10;&#10;```sh&#10;env_config[&#39;CPPPATH&#39;] += path&#10;env_config[&#39;LIBPATH&#39;] += lib_path&#10;env_config[&#39;LIBS&#39;] = libs&#10;env_config[&#39;CXXFLAGS&#39;] += &#39; -Wno-unused-local-typedefs -Wno-unused-variable&#39;&#10;env_config[&#39;LINKFLAGS&#39;] += &#39; -Wl,--eh-frame-hdr&#39;&#10;&#10;env = Environment(**env_config)&#10;#env[&#39;_LIBFLAGS&#39;] = &#39;-Wl,-Bstatic -lmlxproto -lmlxcommon -lprotobuf -lglog -lgflags -lboost_system -lboost_timer -lboost_chrono -ltcmalloc_minimal -lcityhash -lrt -Wl,-Bdynamic -lpthread&#39;&#10;env[&#39;_LIBFLAGS&#39;] = &#39;-Wl,-Bstatic -lmlxproto -lmlxcommon -lprotobuf -lglog -lgflags -lboost_system -lboost_timer -lboost_chrono -lcityhash -lrt -Wl,-Bdynamic -lpthread&#39;&#10;&#10;#sources = [Glob(&#39;../../src/*.cc&#39;)] + [Glob(&#39;../../proto/*.cc&#39;)] + [Glob(&#39;../../src/features/*.cc&#39;)] + [Glob(&#34;./*.cc&#34;)]&#10;env.SharedLibrary(&#39;feature_extractor&#39;, sources)&#10;```&#10;&#10;---&#10;### 15. [malloc: *** error for object 0x7f86a3c08620: pointer being freed was not allocated]()&#10;&#10;&#38169;&#35823;&#21407;&#22240;&#65306;&#25351;&#38024;&#26410;&#21021;&#22987;&#21270;&#65292;&#25351;&#21521;&#20102;&#8220;&#21035;&#30340;&#8221;&#22320;&#22336;&#65288;&#19981;&#20026;null&#65289;&#65292;&#22312;&#37322;&#25918;&#26102;&#25552;&#31034;&#8220;&#37322;&#25918;&#20102;&#26410;&#20998;&#37197;&#22320;&#22336;&#30340;&#25351;&#38024;&#8221;&#12290;&#10;&#10;&#35299;&#20915;&#26041;&#26696;&#65306;&#20219;&#20309;&#25351;&#38024;&#24517;&#39035;&#21021;&#22987;&#21270;&#65292;&#25110;&#32773;&#32473;null&#20540;&#12290;&#22914;&#19979;&#65306;&#10;&#10;```c++&#10;class Tensor &#123;&#10;// ....&#10;private:&#10;  TensorShape tensor_shape_;&#10;  TensorBuffer&#60;T&#62;* buf_ = nullptr;    // &#24517;&#39035;&#21021;&#22987;&#21270;&#10;&#125;; // class Tensor&#10;```&#10;&#10;Case2: &#10;&#10;```c++&#10;core_framework_executor_test(69510,0x7fff7b20f000) malloc: *** error for object 0x3b03126f3b03126f: pointer being freed was not allocated&#10;*** set a breakpoint in malloc_error_break to debug&#10;^CAbort trap: 6 (core dumped)&#10;```&#10;&#10;&#21407;&#22240;&#65306;&#31243;&#24207;&#30001;1~13&#34892;&#25913;&#20026;15~23&#34892;&#25253;&#19978;&#36848;&#38169;&#35823;&#65292;&#21407;&#22240;&#24453;&#26597;&#12290;&#10;&#10;```c++&#10;if (is_lbcast &#38;&#38; is_rbcast) &#123;&#10;    Y.device(d) = X0.reshape(lreshape_dims).broadcast(lbcast_dims).binaryExpr(&#10;      X1.reshape(rreshape_dims).broadcast(rbcast_dims), typename FUNCTOR::func());&#10;  &#125; else if (is_lbcast &#38;&#38; !is_rbcast) &#123;&#10;    Y.device(d) = X0.reshape(lreshape_dims).broadcast(lbcast_dims).binaryExpr(&#10;      X1.reshape(rreshape_dims), typename FUNCTOR::func());&#10;  &#125; else if (!is_lbcast &#38;&#38; is_rbcast) &#123;&#10;    Y.device(d) = X0.reshape(lreshape_dims).binaryExpr(&#10;      X1.reshape(rreshape_dims).broadcast(rbcast_dims), typename FUNCTOR::func());&#10;  &#125; else &#123;&#10;    Y.device(d) = X0.reshape(lreshape_dims).binaryExpr(&#10;      X1.reshape(rreshape_dims), typename FUNCTOR::func());&#10;  &#125;&#10;  /*&#10;    auto X00 = X0.reshape(lreshape_dims);&#10;    if (is_lbcast) &#123;&#10;      X00 = X00.broadcast(lbcast_dims);&#10;    &#125;&#10;    auto X11 = X1.reshape(rreshape_dims);&#10;    if (is_rbcast) &#123;&#10;      X11 = X11.broadcast(rbcast_dims);&#10;    &#125;&#10;    Y.device(d) = X00.binaryExpr(X11, typename FUNCTOR::func());&#10;  */&#10;&#10;  LOG(INFO) &#60;&#60; &#34;Y:\n&#34; &#60;&#60; Y;&#10;```&#10;&#10;Case2: &#25351;&#38024;&#19982;&#23616;&#37096;&#21464;&#37327;&#36171;&#20540;&#30340;&#38382;&#39064;&#10;&#10;```c++&#10;void GradientRegistry::Lookup(const std::string&#38; op, GradCreator* creator) &#123;&#10;  auto it = grad_creator_mapper_.find(op);&#10;  CHECK(it != grad_creator_mapper_.end())&#10;    &#60;&#60; op &#60;&#60; &#34; not in gradient registry.&#34;;&#10;  LOG(DEBUG) &#60;&#60; op &#60;&#60; &#34; has exists.&#34;;&#10;  //creator = &#38;(it-&#62;second);    // Error. &#25253;core dump. &#30001;&#20110;GradCreator&#26159;&#20989;&#25968;&#25351;&#38024;&#65292;&#38590;&#20197;&#25490;&#26597;&#10;  *creator = it-&#62;second;&#10;&#125;&#10;```&#10;&#10;&#20851;&#20110;&#25805;&#20316;&#31526;&#37325;&#36733;&#65306;&#10;&#10;&#62; &#36825;&#37324;&#26377;&#19968;&#28857;&#35201;&#27880;&#24847;&#65306;**&#36820;&#22238;&#20540;&#19981;&#33021;&#26159;&#24341;&#29992;**&#12290;&#22240;&#20026;&#26159;&#24341;&#29992;&#65292;&#20854;&#24341;&#29992;&#30340;&#26159;v0&#65288;&#23616;&#37096;&#21464;&#37327;&#65289;&#30340;&#23545;&#35937;&#65292;&#32780;v0&#22312;&#20989;&#25968;&#32467;&#26463;&#26102;&#20250;&#34987;&#38144;&#27585;&#65292;&#25152;&#20197;&#24341;&#29992;&#23558;&#25351;&#21521;&#19968;&#20010;&#19981;&#23384;&#22312;&#30340;&#23545;&#35937;&#12290;&#32780;&#20351;&#29992;MyVector&#21017;&#26159;&#22312;v0&#34987;&#38144;&#27585;&#26102;&#26500;&#36896;&#23427;&#30340;&#25335;&#36125;&#65292;**&#35843;&#29992;&#20989;&#25968;&#23558;&#24471;&#21040;&#35813;&#25335;&#36125;**&#12290;&#25152;&#20197;&#25335;&#36125;&#26500;&#36896;&#20989;&#25968;&#24517;&#35201;&#26102;&#38656;&#35201;&#37325;&#20889;&#12290;&#10;&#10;---&#10;### 16. [error: no matching constructor for initialization of &#39;std::thread&#39;]()&#10;&#10;&#38169;&#35823;&#25552;&#31034;&#65306;&#10;&#10;```c++&#10;thread_local_test.cc:44:15: error: no matching constructor for initialization of &#39;std::thread&#39;&#10;  std::thread t3(foo, 22);&#10;              ^  ~~~~</span><br></pre></td></tr></table></figure></p>
<p>/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/thread:379:9: note: candidate constructor template not viable: requires single argument ‘<strong>f’, but 2 arguments were<br>      provided<br>thread::thread(_Fp </strong>f)<br>        ^<br>/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/thread:268:5: note: candidate constructor not viable: requires 1 argument, but 2 were provided<br>    thread(const thread&amp;);<br>    ^<br>/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/thread:275:5: note: candidate constructor not viable: requires 0 arguments, but 2 were provided<br>    thread() _NOEXCEPT : __t_(0) {}<br>    ^<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">代码如下：</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;thread&gt;   <span class="comment">// c++11</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">  openmi::ThreadLocal&lt;<span class="keyword">int</span>&gt; g_i;</span><br><span class="line">  g_i.Value() = value;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"foo tid="</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="string">", n="</span> &lt;&lt; g_i.Value() &lt;&lt; <span class="built_in">std</span>::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="function">thread <span class="title">t3</span><span class="params">(foo, 22)</span></span>;</span><br><span class="line">t3.join();</span><br></pre></td></tr></table></figure></p>
<p>编译条件：<code>g++ -g -pthread thread_local_test.cc -o xx</code>。</p>
<p>解决方案：编译条件需要添加-std=c++11 即可解决</p>
<hr>
<h4 id="17-_duplicate_symbol___ZN6openmi4zeroE_in:">17. <a href=""><code>duplicate symbol __ZN6openmi4zeroE in:</code></a></h4><p>编译时具体错误：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">duplicate symbol __ZN6openmi4zeroE in:</span><br><span class="line">    /var/folders/<span class="number">5</span>v/rh3q6_sx62998l6x__3_zllr0000gn/T/log_stream_test-<span class="number">4</span>dfdef.o</span><br><span class="line">    /var/folders/<span class="number">5</span>v/rh3q6_sx62998l6x__3_zllr0000gn/T/log_stream-<span class="number">5415</span>a7.o</span><br><span class="line">ld: <span class="number">1</span> duplicate symbol <span class="keyword">for</span> architecture x86_64</span><br><span class="line">clang: error: linker command failed with <span class="built_in">exit</span> code <span class="number">1</span> (use -v to see invocation)</span><br></pre></td></tr></table></figure>
<p>编译条件：<code>g++ log_stream_test.cc log_stream.cc -o xx</code></p>
<p>错误分析：上述错误意思是出现了<strong>重复的系统符号，即openmi命名空间下的 zero变量</strong>。在<code>log_stream.h</code>文件中确实发现该变量是根据digits得到的：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> digits[] = <span class="string">"9876543210123456789"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> digitsHex[] = <span class="string">"0123456789ABCDEF"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* zero = digits + <span class="number">9</span>;</span><br></pre></td></tr></table></figure>
<p>如果程序是自己写的，大概率可能是头文件（<code>*.h</code>）中_定义_了变量或函数，并且被源文件(.cc/cpp)多次引用 造成的。</p>
<p>解决方案：<code>zero</code>变量计算放在<code>.cc</code>文件中。为避免此种情况再次发生，最好将程序的声明和定义分别放在不同的文件中。不要在头文件中有定义；除非全局变量或inline函数。</p>
<hr>
<h4 id="18-_tools/logging2-cc:40:23:_error:_member_function_&#39;Length&#39;_not_viable:_&#39;this&#39;_argument_has_type_&#39;const_openmi::LogStream::Buffer&#39;">18. <a href=""><code>tools/logging2.cc:40:23: error: member function &#39;Length&#39; not viable: &#39;this&#39; argument has type &#39;const openmi::LogStream::Buffer&#39;</code></a></h4><p>具体错误：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openmit-common/tools/logging2.cc:40:23: error: member function 'Length' not viable: 'this' argument has type 'const openmi::LogStream::Buffer'</span><br><span class="line">      (aka 'const DataBuffer&lt;openmi::kSmallBuffer&gt;'), but function is not marked const</span><br><span class="line">  output_(buf.Data(), buf.Length());</span><br></pre></td></tr></table></figure>
<p>问题：非const参数 传到了const参数上。 </p>
<p>同样错误</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tensor_shape.cc:59:23: error: member function 'Shape' not viable: 'this' argument has type 'const openmi::TensorShape',</span><br><span class="line">      but function is not marked const</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="19-_note:_candidate_template_ignored:_invalid_explicitly-specified_argument_for_template_parameter_&#39;NDIMS&#39;_typename_TTypes&lt;T,_NDIMS&gt;::Tensor_TensorType();">19. <a href=""><code>note: candidate template ignored: invalid explicitly-specified argument for template parameter &#39;NDIMS&#39; typename TTypes&lt;T, NDIMS&gt;::Tensor TensorType();</code></a></h4><p>具体错误：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  /Users/zhouyong03/myhome/openmit/openmix/openmit-mix/unittest/core_framework_tensor_test.cc:13:21: error: no matching member function for call to 'TensorType'</span><br><span class="line">  auto tt = tensor-&gt;TensorType&lt;dsize&gt;();</span><br><span class="line">            ~~~~~~~~^~~~~~~~~~~~~~~~~</span><br><span class="line">/Users/zhouyong03/myhome/openmit/openmix/openmit-mix/graph_new/core/framework/tensor.h:28:37: note: candidate template ignored: invalid explicitly-specified argument for template</span><br><span class="line">      parameter 'NDIMS'</span><br><span class="line">  typename TTypes&lt;T, NDIMS&gt;::Tensor TensorType();</span><br></pre></td></tr></table></figure>
<p>问题：这里参数模版NDIMS原型是template<size_t ndims="">，dsize是局部变量。C++规定：<strong>绑定非类型模版(nontype template parameters)的实参必须是常量表达式(constexpr)。</strong> 局部变量等不允许传入。 </size_t></p>
<hr>
<h4 id="20-_Bus_error:_10_(core_dumped)">20. <a href=""><code>Bus error: 10 (core dumped)</code></a></h4><p>问题：提示总线错误Bus error。<br>原因：提前使用了未new（即未分配空间）的对象。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data_-&gt;fullname_ = file;</span><br><span class="line">data_-&gt;basename_ = ConstShortFileName(data_-&gt;fullname_);</span><br><span class="line">data_-&gt;log_severity_ = severity;</span><br><span class="line">allocated_ = NULL;</span><br><span class="line">allocated_ = <span class="keyword">new</span> LogMessageData();</span><br><span class="line">data_ = allocated_;</span><br><span class="line">data_-&gt;first_fatal_ = <span class="keyword">false</span>;</span><br></pre></td></tr></table></figure>
<p>解决：将1,2,3行放在第6行之后即可。</p>
<hr>
<h4 id="21-_error:_allocation_of_incomplete_type_&#39;Eigen::ThreadPoolDevice&#39;">21. <a href=""><code>error: allocation of incomplete type &#39;Eigen::ThreadPoolDevice&#39;</code></a></h4><p>编译时遇到错误：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openmi/core/common_runtime/local_device.cc:13:11: error: allocation of incomplete type 'Eigen::ThreadPoolDevice'</span><br><span class="line">      new Eigen::ThreadPoolDevice(</span><br><span class="line">          ^~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">openmi-base/base/device.h:7:8: note: forward declaration of 'Eigen::ThreadPoolDevice'</span><br><span class="line">struct ThreadPoolDevice;</span><br><span class="line">       ^</span><br><span class="line">openmi/core/common_runtime/local_device.cc:44:43: error: member access into incomplete type 'Eigen::ThreadPoolDevice'</span><br><span class="line">  SetEigenCpuDevice(tp_info-&gt;eigen_device_-&gt;get());</span><br></pre></td></tr></table></figure>
<p>问题原因：<code>出现这个问题，表明编译器不知道所用的struct 或者是class的具体实现</code>，这里可以看到device.h第7行的前向声明没有找到对应实现。 这里提示Eigen::ThreadPoolDevice不完整的原因是使用Eigen线程池必须要添加编译选项 <code>-DEIGEN_USE_THREADS</code></p>
<p>解决方案：编译时添加编译选项<code>-DEIGEN_USE_THREADS</code></p>
<hr>
<h4 id="22-_error:_C++_requires_a_type_specifier_for_all_declarations">22. <a href=""><code>error: C++ requires a type specifier for all declarations</code></a></h4><p>出错原因： 代码片段没有写在函数中。<br>解决方法： 将代码片段写进函数中。</p>
<hr>
<h4 id="23-_[malloc:_***_error_for_object_0x7ff62a6010e8:_incorrect_checksum_for_freed_object_-_object_was_probably_modified_after_being_freed-]">23. [<code>malloc: *** error for object 0x7ff62a6010e8: incorrect checksum for freed object - object was probably modified after being freed.</code>]</h4><p>具体错误信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">core_framework_executor_<span class="built_in">test</span>(<span class="number">87702</span>,<span class="number">0</span>x7fff7b20f000) malloc: *** error <span class="keyword">for</span> object <span class="number">0</span>x7ff62a6010e8: incorrect checksum <span class="keyword">for</span> freed object - object was probably modified after being freed.</span><br><span class="line">*** <span class="built_in">set</span> a breakpoint <span class="keyword">in</span> malloc_error_<span class="built_in">break</span> to debug</span><br></pre></td></tr></table></figure>
<p>错误原因：Eigen矩阵乘法运算，rows和cols不匹配。例如： w*x = y，前向的转制问题，会影响到后置；</p>
<p>解决办法：代码中check W*X与Y的shape是否相等，提前曝出问题；</p>
<hr>
<h4 id="24-_[&#39;operator()&#39;_cannot_be_the_name_of_a_variable_or_data_member]">24. [<code>&#39;operator()&#39; cannot be the name of a variable or data member</code>]</h4><p>错误日志与代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openmi/core/softmax_op.cc:<span class="number">10</span>:<span class="number">17</span>: error: expected <span class="string">')'</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">(Device&amp; d, <span class="keyword">typename</span> TTypes&lt;T&gt;::ConstMatrix logits,</span><br><span class="line">                ^</span><br><span class="line">openmi/core/softmax_op.cc:10:16: note: to match <span class="keyword">this</span> '('</span><br><span class="line">  <span class="keyword">void</span> <span class="keyword">operator</span>(Device&amp; d, <span class="keyword">typename</span> TTypes&lt;T&gt;::ConstMatrix logits,</span><br><span class="line">               ^</span><br><span class="line">openmi/core/softmax_op.cc:10:8: error: '<span class="keyword">operator</span>()</span>' cannot be the name of a variable or data member</span><br><span class="line">  <span class="keyword">void</span> <span class="title">operator</span><span class="params">(Device&amp; d, <span class="keyword">typename</span> TTypes&lt;T&gt;::ConstMatrix logits,</span><br><span class="line">       ^</span></span></span><br></pre></td></tr></table></figure>
<p>代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Device, <span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> SoftmaxFunctor &#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">(Device&amp; d, <span class="keyword">typename</span> TTypes&lt;T&gt;::ConstMatrix logits, <span class="keyword">typename</span> TTypes&lt;T&gt;::Matrix softmax, <span class="keyword">const</span> <span class="keyword">bool</span> is_log)</span></span>;</span><br><span class="line">&#125;; <span class="comment">// struct SoftmaxFunctor</span></span><br></pre></td></tr></table></figure>
<p>原因：仿函数实现形式错误，应改为<code>operator()(....)</code>,<strong>不能缺少operator与参数列表之间的()</strong></p>
<hr>
<h4 id="25-_[Assertion_failed:_(dimensions_match(m_leftImpl-dimensions(),_m_rightImpl-dimensions())),_function_evalSubExprsIfNeeded]">25. [<code>Assertion failed: (dimensions_match(m_leftImpl.dimensions(), m_rightImpl.dimensions())), function evalSubExprsIfNeeded</code>]</h4><p>错误日志与代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Assertion failed: (dimensions_match(m_leftImpl.dimensions(), m_rightImpl.dimensions())), function evalSubExprsIfNeeded, file /Users/zhouyong03/myhome/openmit/tech-stacks/ml_eigen/third_party/deps/eigen/include/eigen3/unsupported/Eigen/CXX11/src/Tensor/TensorAssign.h, line <span class="number">122.</span></span><br></pre></td></tr></table></figure>
<p>代码： </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> d = context-&gt;<span class="keyword">template</span> eigen_device&lt;Device&gt;();</span><br><span class="line">Y.device(d) = X.sum(depth_dim);</span><br></pre></td></tr></table></figure>
<p>错误提示的意思是：等号左右结果的rank不一致。<code>X.sum()</code>计算后rank=0, <code>X.sum(depth_dim)</code>计算后rank=NDIM-1. NDIM为X的rank。所以上述错误有两种解决方案：</p>
<ol>
<li>重新确定Y的rank，如：<code>TensorMap&lt;T, NDIM-1&gt; Y(${Y_dims})</code></li>
<li>计算时改为：<code>Y.device(d) = X.sum(depth_dim).eval().reshape(${Y_dims})</code></li>
</ol>
<hr>
<h4 id="26-_[strncpy_core_dump]">26. [<code>strncpy core dump</code>]</h4><p>代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> size = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span>* buf = <span class="keyword">new</span> <span class="keyword">char</span>[size];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">x</span><span class="params">("hello,hello")</span></span>;</span><br><span class="line">  <span class="built_in">strncpy</span>(buf, x.c_str(), size);</span><br><span class="line">  buf[size-<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1 buff: "</span> &lt;&lt; buf &lt;&lt; <span class="built_in">std</span>::endl;  <span class="comment">// right</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">y</span><span class="params">("hello,hello")</span></span>;</span><br><span class="line">  <span class="built_in">strncpy</span>(buf, y.c_str(), size);</span><br><span class="line">  buf[size-<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2 buff: "</span> &lt;&lt; buf &lt;&lt; <span class="built_in">std</span>::endl; <span class="comment">// right</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* delim_token_ = <span class="string">","</span>;</span><br><span class="line">  <span class="keyword">char</span>* token = <span class="keyword">nullptr</span>;</span><br><span class="line">  <span class="keyword">while</span> ((token = strsep(&amp;buf, delim_token_)) != <span class="keyword">nullptr</span>) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"token: "</span> &lt;&lt; token;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"strsep buf: "</span> &lt;&lt; buf &lt;&lt; <span class="built_in">std</span>::endl; <span class="comment">// error</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">z</span><span class="params">("hello,hello")</span></span>;</span><br><span class="line">  <span class="built_in">strncpy</span>(buf, z.c_str(), size);</span><br><span class="line">  buf[size-<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"z buff: "</span> &lt;&lt; buf &lt;&lt; <span class="built_in">std</span>::endl;    <span class="comment">// core dump</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zhouyong03deMacBook-Pro:unittest zhouyong03$ g++ -std=c++<span class="number">11</span> strncpy_test.cc -o xx</span><br><span class="line">zhouyong03deMacBook-Pro:unittest zhouyong03$ ./xx</span><br><span class="line"><span class="number">1</span> buff: hello,hello</span><br><span class="line"><span class="number">2</span> buff: hello,hello</span><br><span class="line">Segmentation fault: <span class="number">11</span> (core dumped)</span><br></pre></td></tr></table></figure>
<p>错误原因是strsep会不断的移位buf指针，最后buf指向null，所以<code>strsep buf</code>报错.</p>
<hr>
<h3 id="27-_basic_string::_S_construct_NULL_not_valid">27. <a href="">basic_string::_S_construct NULL not valid</a></h3><p>具体错误：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">terminate called after throwing an instance of 'std::logic_error'</span><br><span class="line">  what():  basic_string::_S_construct NULL not valid</span><br><span class="line">Aborted (core dumped)</span><br></pre></td></tr></table></figure>
<p>非常明显的错误，就是<strong>用null初始化了std::string字符串</strong>。那么，关键是定位初始化字符串是可能是null值的代码。这里使用valgrind工具定位，发现下述错误：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">29007</span>== <span class="number">144</span> bytes <span class="keyword">in</span> <span class="number">1</span> blocks are possibly lost <span class="keyword">in</span> loss record <span class="number">5</span> of <span class="number">7</span></span><br><span class="line">==<span class="number">29007</span>==    at <span class="number">0</span>x4C26E85: malloc (vg_replace_malloc.c:<span class="number">309</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x4EEE746: __cxa_allocate_exception (<span class="keyword">in</span> /usr/lib64/libstdc++.so.<span class="number">6.0</span>.<span class="number">13</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x4E94801: std::__throw_logic_error(char const*) (<span class="keyword">in</span> /usr/lib64/libstdc++.so.<span class="number">6.0</span>.<span class="number">13</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x4ECFE58: ??? (<span class="keyword">in</span> /usr/lib64/libstdc++.so.<span class="number">6.0</span>.<span class="number">13</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x4ECFF32: std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;::basic_string(char const*, std::allocator&lt;char&gt; const&amp;) (<span class="keyword">in</span> /usr/lib64/libstdc++.so.<span class="number">6.0</span>.<span class="number">13</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x4059F3: featurex::internal::SystemInfo::Hostname() (logging.cc:<span class="number">357</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x4068FC: featurex::internal::LogFile::PrettyLogFileName(long*) (logging.cc:<span class="number">540</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x40637A: featurex::internal::LogFile::RollFile() (logging.cc:<span class="number">494</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x405ED9: featurex::internal::LogFile::LogFile(char const*, char const*, long, std::string, bool, int, int) (logging.cc:<span class="number">446</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x40457B: featurex::LogDestination::LogDestination(long, int) (logging.cc:<span class="number">77</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x404421: featurex::LogDestination::<span class="built_in">log</span>_destination(int, long) (logging.cc:<span class="number">56</span>)</span><br><span class="line">==<span class="number">29007</span>==    by <span class="number">0</span>x404F5C: featurex::LogMessage::Flush() (logging.cc:<span class="number">208</span>)</span><br></pre></td></tr></table></figure>
<p>定位到获取HostName失败，代码返回NULL所致。错误代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> SystemInfo::Hostname() &#123;</span><br><span class="line">  <span class="keyword">if</span> (host_name_.empty()) &#123;</span><br><span class="line">    <span class="keyword">char</span> hostname[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">if</span> (gethostname(hostname,<span class="keyword">sizeof</span>(hostname)) != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">std</span>::runtime_error(<span class="string">"get host name error."</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"[%s:%s:%d] host name get failed.\n"</span>, __FILE__, __func__, __LINE__);</span><br><span class="line">      <span class="keyword">return</span> NULL;     <span class="comment">// error code. </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">host_name</span><span class="params">(hostname)</span></span>;</span><br><span class="line">    <span class="comment">//host_name.pop_back();  // drop '\n' in hostname</span></span><br><span class="line">    host_name_ = host_name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> host_name_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解决：gethostname获取失败时不应返回NULL, 可以给默认值；2. 获取失败的原因是<code>char hostname[32]</code>数组太小，可以改大一些。修改后的代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> SystemInfo::Hostname() &#123;</span><br><span class="line">  <span class="keyword">if</span> (host_name_.empty()) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> length = <span class="number">128</span>;</span><br><span class="line">    <span class="keyword">char</span> hostname[length];</span><br><span class="line">    <span class="keyword">if</span> (gethostname(hostname, <span class="keyword">sizeof</span>(hostname)) != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">std</span>::runtime_error(<span class="string">"get host name error."</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"[%s:%s:%d] host name get failed.\n"</span>, __FILE__, __func__, __LINE__);</span><br><span class="line">      hostname[length - <span class="number">1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">host_name</span><span class="params">(hostname)</span></span>;</span><br><span class="line">    <span class="comment">//host_name.pop_back();  // drop '\n' in hostname</span></span><br><span class="line">    host_name_ = host_name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> host_name_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="28-_Conditional_jump_or_move_depends_on_uninitialised_value(s)">28. <a href="">Conditional jump or move depends on uninitialised value(s)</a></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">6081</span>== Conditional jump or move depends on uninitialised value(s)</span><br><span class="line">==<span class="number">6081</span>==    at <span class="number">0</span>x1002770E5: featurex::internal::LogFile::WriteUnlocked(char const*, unsigned long) (logging.cc:<span class="number">480</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x10027552D: featurex::LogMessage::Flush() (logging.cc:<span class="number">470</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100275762: featurex::LogMessage::~LogMessage() (logging.cc:<span class="number">151</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x10026E093: featurex::Combine::InternalRun(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) (combine.cc:<span class="number">82</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x10026E3FE: featurex::Combine::InternalRun(featurex::FeatureValue*, featurex::FeatureValue*) (combine.cc:<span class="number">119</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x10026D9D3: featurex::Combine::Compute(std::__1::shared_ptr&lt;featurex::InputValue&gt; const&amp;) (combine.cc:<span class="number">62</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100264027: featurex::FeatureManager::Compute(std::__1::shared_ptr&lt;featurex::FeatureInfo&gt;&amp;) (feature_manager.cc:<span class="number">251</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x10026488D: featurex::FeatureManager::ExtractUniqueFeature(std::__1::shared_ptr&lt;featurex::RawFeature&gt; const&amp;, std::__1::shared_ptr&lt;featurex::RawFeature&gt; const&amp;, std::__1::shared_ptr&lt;featurex::proto::FeatureResult&gt;&amp;) (feature_manager.cc:<span class="number">358</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100260010: featurex::FeatureExtractor::ExtractUniqueFeature() (feature_extractor.cc:<span class="number">263</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100260C62: featurex::FeatureExtractor::Extract(featurex::proto::RawFeature&amp;) (feature_extractor.cc:<span class="number">349</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100002943: main (feature_extractor_valgrind_test.cc:<span class="number">61</span>)</span><br><span class="line">==<span class="number">6081</span>==  Uninitialised value was created by a heap allocation</span><br><span class="line">==<span class="number">6081</span>==    at <span class="number">0</span>x10023FD11: malloc (vg_replace_malloc.c:<span class="number">302</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x1006887DD: operator new(unsigned long) (<span class="keyword">in</span> /usr/lib/libc++.<span class="number">1</span>.dylib)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100274968: featurex::LogDestination::LogDestination(long long, int) (logging.cc:<span class="number">73</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x1002754CE: featurex::LogMessage::Flush() (logging.cc:<span class="number">71</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100275762: featurex::LogMessage::~LogMessage() (logging.cc:<span class="number">151</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x100259077: featurex::FeatureConf::LoadConf(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) (feature_conf.cc:<span class="number">24</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x10025EE1C: featurex::FeatureExtractor::Init(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) (feature_extractor.cc:<span class="number">84</span>)</span><br><span class="line">==<span class="number">6081</span>==    by <span class="number">0</span>x1000025EA: main (feature_extractor_valgrind_test.cc:<span class="number">28</span>)</span><br></pre></td></tr></table></figure>
<p>原因：</p>
<p>报<code>Uninitialised value was created by a heap allocation</code>／<code>Conditional jump or move depends on uninitialised value(s)</code>这类错误，表示有些变量未初始化。</p>
<p>解决方案：1. 找到未初始化的变量（包括基本类型变量），然后初始化；2. 涉及到分配内存的变量，尝试使用calloc替换malloc。</p>
<p>该case的原因是：1. <code>LogFile::thread_safe_</code>和<code>LogFile::flush_interval_</code>等变量未初始化；</p>
<hr>
<h4 id="29:_Cannot_access_memory_at_address_0x7f0ca4de1d08_…">29: <a href="">Cannot access memory at address 0x7f0ca4de1d08 …</a></h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Failed <span class="keyword">to</span> <span class="command">read</span> a valid object <span class="type">file</span> image <span class="keyword">from</span> memory.</span><br><span class="line">Core was generated <span class="keyword">by</span> `/usr/<span class="keyword">local</span>/java8/bin/java -server -Dfile.encoding=UTF-<span class="number">8</span> -Dsun.jnu.encoding=UTF-'.</span><br><span class="line">Program terminated <span class="keyword">with</span> signal <span class="number">6</span>, Aborted.</span><br><span class="line"><span class="comment">#0  0x00007f1083a234f5 in ?? ()</span></span><br><span class="line">(gdb) bt</span><br><span class="line"><span class="comment">#0  0x00007f1083a234f5 in ?? ()</span></span><br><span class="line">Cannot access memory <span class="keyword">at</span> address <span class="number">0x7f0ca4de1d08</span></span><br></pre></td></tr></table></figure>
<p>featurex框架上线初始化<code>feature_extractor</code>时报的错误，场景：同时初始化到综和美食的配置，每次初始化会初始化<code>num_thread</code>个；</p>
<p>网上有评论上述错误可能是：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">a</span> valid <span class="tag">object</span> file image 这可不是图片呀！应该是多线程引起的内存冲突。 不好查。</span><br><span class="line"></span><br><span class="line">这个一看 应该是多线程导致内存泄露的问题，错误信息是获取有效的内存镜像失败；core文件是产生自/usr/local/niker，你可以用gdb调试，跟踪一下进入这个文件之后的一些线程调用函数。</span><br></pre></td></tr></table></figure>
<p>在这里，使用<code>gdb java8 ${corefile}</code>打开，bt命令观察发现如下错误：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Loaded symbols for /usr/local/jdk1.8.0_45/jre/lib/amd64/libawt.so</span><br><span class="line">Reading symbols from /usr/local/jdk1.8.0_45/jre/lib/amd64/libawt_headless.so...(no debugging symbols found)...done.</span><br><span class="line">Loaded symbols for /usr/local/jdk1.8.0_45/jre/lib/amd64/libawt_headless.so</span><br><span class="line">Reading symbols from /tmp/libidxdb-jni-c.so4690097535416358788...done.</span><br><span class="line">Loaded symbols for /tmp/libidxdb-jni-c.so4690097535416358788</span><br><span class="line">Reading symbols from /opt/meituan/mobile/adsms/webroot/WEB-INF/classes/libgomp.so.1...done.</span><br><span class="line">Loaded symbols for /opt/meituan/mobile/adsms/webroot/WEB-INF/classes/libgomp.so.1</span><br><span class="line">Reading symbols from /opt/meituan/mobile/adsms/webroot/WEB-INF/classes/libfeaturex.so...done.</span><br><span class="line">Loaded symbols for /opt/meituan/mobile/adsms/webroot/WEB-INF/classes/libfeaturex.so</span><br><span class="line">Core was generated by `/usr/local/java8/bin/java -server -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-'.</span><br><span class="line">Program terminated with signal 6, Aborted.</span><br><span class="line">#0  0x00007f64168364f5 in raise () from /lib64/libc.so.6</span><br><span class="line">Missing separate debuginfos, use: debuginfo-install glibc-2.12-1.212.el6_10.3.x86_64 jdk-1.8.0-45.x86_64 keyutils-libs-1.4-5.el6.x86_64 krb5-libs-1.10.3-37.el6_6.x86_64 libcom_err-1.41.12-21.el6.x86_64 libgcc-4.4.7-23.el6.x86_64 libselinux-2.0.94-5.8.el6.x86_64 libstdc++-4.4.7-23.el6.x86_64 openssl-1.0.1e-57.el6.x86_64 zlib-1.2.3-29.el6.x86_64</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  0x00007f64168364f5 in raise () from /lib64/libc.so.6</span><br><span class="line">#1  0x00007f6416837cd5 in abort () from /lib64/libc.so.6</span><br><span class="line">#2  0x00007f641614b6b5 in os::abort(bool) () from /usr/local/jdk1.8.0_45/jre/lib/amd64/server/libjvm.so</span><br><span class="line">#3  0x00007f64162e8da3 in VMError::report_and_die() () from /usr/local/jdk1.8.0_45/jre/lib/amd64/server/libjvm.so</span><br><span class="line">#4  0x00007f6416150bdf in JVM_handle_linux_signal () from /usr/local/jdk1.8.0_45/jre/lib/amd64/server/libjvm.so</span><br><span class="line">#5  0x00007f6416147493 in signalHandler(int, siginfo*, void*) () from /usr/local/jdk1.8.0_45/jre/lib/amd64/server/libjvm.so</span><br><span class="line">#6  &lt;signal handler called&gt;</span><br><span class="line">#7  0x00007f6416fbd64f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007f61d85c32fc in std::condition_variable::wait(std::unique_lock&lt;std::mutex&gt;&amp;) () from /usr/lib64/libstdc++.so.6</span><br><span class="line">#9  0x00007f6049efde6b in wait&lt;featurex::FeatureExtractor::ClearProtoObject()::&lt;lambda()&gt; &gt; (this=0x7f62a6fe4980)</span><br><span class="line">    at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/condition_variable:98</span><br><span class="line">#10 featurex::FeatureExtractor::ClearProtoObject (this=0x7f62a6fe4980)</span><br><span class="line">    at /opt/meituan/zhouyong03/featurex/featurex/feature/feature_extractor.cc:575</span><br><span class="line">#11 0x00007f61d85c3470 in ?? () from /usr/lib64/libstdc++.so.6</span><br><span class="line">#12 0x00007f6416fb9aa1 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#13 0x00007f64168ecc4d in clone () from /lib64/libc.so.6</span><br></pre></td></tr></table></figure>
<p>可以看到是<code>feature_extractor.cc:575</code> ClearProtoObject报的错误，代码实现为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> FeatureExtractor::ClearProtoObject() &#123;</span><br><span class="line">  assert(stop_ == <span class="keyword">false</span>);</span><br><span class="line">  <span class="keyword">while</span> (!stop_) &#123;</span><br><span class="line">    <span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; lock(mutex_);</span><br><span class="line">    cond_.wait(lock, [<span class="keyword">this</span>] &#123;</span><br><span class="line">      <span class="keyword">if</span> (stop_) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (full_request_batch_ptr_ == <span class="keyword">nullptr</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> full_request_batch_ptr_-&gt;has_instances();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (full_request_batch_ptr_ != <span class="keyword">nullptr</span>) &#123;</span><br><span class="line">      full_request_batch_ptr_-&gt;Clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  DLOG(INFO) &lt;&lt; <span class="string">"Async ClearProtoObject done."</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是其中<code>cond_.wait</code>报错，暂时先去除后台线程清理proto object的功能。</p>
<p>之所以使用<code>gdb java8</code>打开core文件，是因为直接使用gdb打开，出现以下提示<code>Core was generated by /usr/local/java8/bin/java -server -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-&#39;.</code> 因此需要添加java8（注意，不能是java）</p>
<hr>
<h4 id="30_unsupported/Eigen/CXX11/src/Tensor/TensorStorage-h:39:7:_error:_class_template_partial">30 <a href="https://eigen.tuxfamily.org/bz/show_bug.cgi?id=1459" target="_blank" rel="external">unsupported/Eigen/CXX11/src/Tensor/TensorStorage.h:39:7: error: class template partial</a></h4><p>具体错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~/.openmi_deps/include/eigen3/unsupported/Eigen/CXX11/src/Tensor/TensorStorage.h:<span class="number">39</span>:<span class="number">7</span>: error: class template partial</span><br><span class="line">      specialization is not more specialized than the primary template [-Winvalid-partial-specialization]</span><br><span class="line">class TensorStorage&lt;T, FixedDimensions, Options_&gt;</span><br><span class="line">      ^</span><br><span class="line">~/.openmi_deps/include/eigen3/unsupported/Eigen/CXX11/src/Tensor/TensorStorage.h:<span class="number">34</span>:<span class="number">63</span>: note: template is declared here</span><br><span class="line">template&lt;typename T, typename Dimensions, int Options_&gt; class TensorStorage;</span><br></pre></td></tr></table></figure>
<p>原因：mac升级至10.15，更高版本的clang对模版检查更智能。</p>
<p>解决：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">将unsupported/Eigen/CXX11/src/Tensor/TensorStorage.h中的</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Dimensions, <span class="keyword">int</span> Options_, &gt; <span class="keyword">class</span> TensorStorage;</span><br><span class="line">替换为</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Dimensions, <span class="keyword">int</span> Options_, <span class="keyword">typename</span> empty = <span class="keyword">void</span>&gt; <span class="keyword">class</span> TensorStorage;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="31-_dyld:_lazy_symbol_binding_failed:_Symbol_not_found:____emutls_get_address"><a href="http://www.ncl.ucar.edu/Download/macosx.shtml" target="_blank" rel="external">31. dyld: lazy symbol binding failed: Symbol not found: ___emutls_get_address</a></h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> .<span class="regexp">/xgboost demo/</span>binary_classification/mushroom.conf</span><br><span class="line"><span class="string">dyld:</span> lazy symbol binding <span class="string">failed:</span> Symbol not <span class="string">found:</span> ___emutls_get_address</span><br><span class="line">  Referenced <span class="string">from:</span> <span class="regexp">~/myhome/</span>openmit<span class="regexp">/openmi/</span>openmi-base<span class="regexp">/project_deps/</span>third_party<span class="regexp">/xgboost/</span>./xgboost</span><br><span class="line">  Expected <span class="string">in:</span> <span class="regexp">/usr/</span>lib/libSystem.B.dylib</span><br><span class="line"><span class="label"></span><br><span class="line">dyld:</span> Symbol not <span class="string">found:</span> ___emutls_get_address</span><br><span class="line">  Referenced <span class="string">from:</span> <span class="regexp">~/myhome/</span>openmit<span class="regexp">/openmi/</span>openmi-base<span class="regexp">/project_deps/</span>third_party<span class="regexp">/xgboost/</span>./xgboost</span><br><span class="line">  Expected <span class="string">in:</span> <span class="regexp">/usr/</span>lib/libSystem.B.dylib</span><br><span class="line"></span><br><span class="line">Abort <span class="string">trap:</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>编译正常，运行时提示Symbol找不到，主要原因是运行时加载了旧的gcc动态库，而编译时用的是新gcc库（macos编译时用的gcc-9, 默认是4.2.1）。</p>
<p>解决方案1：在~/.bash_profile中<code>DYLD_FALLBACK_LIBRARY_PATH</code>指定为新gcc的lib路径，即：</p>
<p><code>export DYLD_FALLBACK_LIBRARY_PATH=/usr/local/Cellar/gcc/9.2.0_2/lib/gcc/9</code></p>
<p>解决方案2：macos系统中的<code>LD_LIBRARY_PATH</code>更换为<code>DYLD_LIBRARY_PATH</code></p>
<p>最主要的原因是macos动态库不应该配置在<code>LD_LIBRARY_PATH</code>而是<code>DYLD_LIBRARY_PATH</code>变量</p>
<blockquote>
<p>macos寻找动态库的顺序依次是：<code>DYLD_LIBRARY_PATH</code> -&gt; <code>BACK_FRAMEWORK_PATH</code> | <code>DYLD_FALLBACK_LIBRARY_PATH</code>，见下面对<code>DYLD_LIBRARY_PATH</code>的解读<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is <span class="operator">a</span> <span class="constant">colon</span> separated list <span class="operator">of</span> <span class="built_in">directories</span> that contain libraries. The dynamic linker searches these <span class="built_in">directories</span> <span class="keyword">before</span> <span class="keyword">it</span> searches <span class="operator">the</span> default locations <span class="keyword">for</span> libraries. It allows you <span class="built_in">to</span> test <span class="built_in">new</span> versions <span class="operator">of</span> existing libraries. For <span class="keyword">each</span> library that <span class="operator">a</span> program uses, <span class="operator">the</span> dynamic linker looks <span class="keyword">for</span> <span class="keyword">it</span> <span class="operator">in</span> <span class="keyword">each</span> <span class="built_in">directory</span> <span class="operator">in</span> DYLD_LIBRARY_PATH <span class="operator">in</span> turn. If <span class="keyword">it</span> still can<span class="string">'t find the library, it then searches BACK_FRAMEWORK_PATH and DYLD_FALLBACK_LIBRARY_PATH in turn.</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h4 id="libtool:_error:_unrecognised_option:_‘-static’"><a href="https://stackoverflow.com/questions/38301930/libtool-unrecognized-option-static" target="_blank" rel="external">libtool:   error: unrecognised option: ‘-static’</a></h4><p>问题：mac上安装boost时出现下述错误，而libtool是使用brew安装的。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libtool: unrecognized option `-static<span class="string">'</span><br><span class="line">libtool: Try `libtool --help'</span> <span class="keyword">for</span> more information.</span><br></pre></td></tr></table></figure>
<p>解决：需要使用mac系统自带的libtool版本才可以（路径在：<code>/Library/Developer/CommandLineTools/usr/bin</code>）</p>
<h2 id="编程技巧">编程技巧</h2><p><strong>回调函数</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> OpKernelBase &#123;</span><br><span class="line">  <span class="keyword">using</span> Callback = <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>(Status)&gt;;</span><br><span class="line">  <span class="keyword">void</span> OpKernelContext::SetLaunchDone(OpKernelBase::Callback launch_done) &#123;</span><br><span class="line">  launch_done_ = launch_done;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  Callback launch_done_;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">ctx-&gt;SetLaunchDone([<span class="keyword">this</span>, node_id, ctx](Status st)&#123;LaunchDone(node_id, ctx, st);&#125;)l</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程语言与技术/">编程语言与技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/C/">C++</a><a href="/tags/多线程/">多线程</a><a href="/tags/异步编程/">异步编程</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/2/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/OpenMIT/" title="OpenMIT">OpenMIT<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/分布式机器学习/" title="分布式机器学习">分布式机器学习<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/深度学习/图网络/" title="图网络">图网络<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/强化学习与智能决策/" title="强化学习与智能决策">强化学习与智能决策<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/概率与统计/" title="概率与统计">概率与统计<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/深入浅出机器学习/" title="深入浅出机器学习">深入浅出机器学习<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/深度学习/" title="深度学习">深度学习<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程语言与技术/" title="编程语言与技术">编程语言与技术<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/计算广告学/" title="计算广告学">计算广告学<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/计算广告学/" title="计算广告学">计算广告学<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Agent/" title="Agent">Agent<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/参数服务器/" title="参数服务器">参数服务器<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Attention/" title="Attention">Attention<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/DP/" title="DP">DP<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Policy-Evalation/" title="Policy Evalation">Policy Evalation<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Policy-Improvement/" title="Policy Improvement">Policy Improvement<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Policy-Iteration/" title="Policy Iteration">Policy Iteration<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Value-Iteration/" title="Value Iteration">Value Iteration<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Greedy-Policy/" title="Greedy Policy">Greedy Policy<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/连续随机变量/" title="连续随机变量">连续随机变量<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MDP/" title="MDP">MDP<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Markov-Decision-Process/" title="Markov Decision Process">Markov Decision Process<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/RL/" title="RL">RL<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Environments/" title="Environments">Environments<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/GD/" title="GD">GD<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/FTRL/" title="FTRL">FTRL<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/AdaGrad/" title="AdaGrad">AdaGrad<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/AdaDelta/" title="AdaDelta">AdaDelta<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Adam/" title="Adam">Adam<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, Welcome to CAML technology sharing platform.  <br/>
			I&#39;m Zhou Yong, engaged in algorithms work on computational advertising and machine learning.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1707438033" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/ComputationalAds" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:zhouyongsdzh@foxmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="ZhouYong">ZhouYong</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>
 </html>
